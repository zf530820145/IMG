# Android耗电量分析

## 主要的耗电

>在Android中主要的耗电来自这几个方面，CPU，网络请求，唤醒锁定，后台任务，定位等。

1. 唤醒和保持设备不进入睡眠状态的机制。例如，播放视频的应用可以使用唤醒锁定，以便在没有用户与设备交互时保持屏幕开启。请求唤醒锁定不是一项能耗密集型操作，但未能释放唤醒锁定会导致屏幕或CPU保持打开状态的时间超过必要时间，这会导致电池快速耗尽。

2. 定期在应用程序上下文之外运行后台任务。当警报响起时，它可能会唤醒设备并运行能耗密集型代码。

3. 频繁的网络请求和大数据量的吞吐

4. CPU大量的计算和I/O读写

5. 位置请求使用GPS传感器，会消耗大量电量
---
## 耗电量分析
> 分析App的耗电量，需要从2个方面入手，生成耗电量报告和定位耗电量较多的原因

#### Energy Profiler
>Energy Profiler 是 Android Studio 提供的一个关于耗电量统计与分析的工具

##### 1. 打开 Profiler
</br>
![image1](https://raw.githubusercontent.com/zf530820145/IMG/master/%E8%80%97%E7%94%B5%E9%87%8F%E5%88%86%E6%9E%90%E5%9B%BE1.png)
</br>

##### 2. 单击时间轴中的任意位置以打开Energy Profiler
</br>
![image2](https://raw.githubusercontent.com/zf530820145/IMG/master/%E8%80%97%E7%94%B5%E9%87%8F%E5%88%86%E6%9E%90%E5%9B%BE2.png)

如图所示，Energy Profiler的默认视图包括以下时间轴：

* Event timeline：显示应用在其生命周期中的不同状态转换时的活动。此时间线还指示用户与设备的交互，包括屏幕旋转事件。
* Energy timeline：显示应用的估计能耗。
* System timeline：表示可能影响能耗的系统事件。

>要查看CPU，网络和位置（GPS）资源以及相关系统事件的能源使用情况，请将鼠标指针放在能源时间轴中的条形图上


##### 3. 使用Energy Profiler查找可能影响能耗的系统事件，包括唤醒锁定，后台任务等
</br>
![image3](https://raw.githubusercontent.com/zf530820145/IMG/master/%E8%80%97%E7%94%B5%E9%87%8F%E5%88%86%E6%9E%90%E5%9B%BE3.png)


* System Event“ 系统事件”窗格并显示唤醒锁定等事件的详细信息，在“ 能源”时间轴中选择一个时间范围。
* 要打开Wake Lock Details“ 唤醒锁定详细信息”窗格并显示特定唤醒锁定的详细信息，在“ 系统事件”窗格中选择唤醒锁定。 唤醒锁用红色条表示，作业和警报用黄色条表示，位置事件用浅紫色条表示
* 要打开代码编辑器并跳转到唤醒锁定的源代码，在“ 唤醒锁定详细信息”窗格中双击调用堆栈顶部的调用方法条目。
* 获取唤醒锁定的调用在源代码编辑器中突出显示。

##### 4. 利用CPU Profiler查找最耗时的操作或任务
</br>
 通过查找占用CPU资源最长的方法，定位具体的耗时操作
</br>
![image4](https://raw.githubusercontent.com/zf530820145/IMG/master/%E8%80%97%E7%94%B5%E9%87%8F%E5%88%86%E6%9E%90%E5%9B%BE4.png)
